<?php
$title = 'Media Library';
$this->headTitle($title);
?>
<h1><?php echo $this->escapeHtml($title); ?></h1>
<p><a href="<?php echo $this->url('blog', array(
    'controller' => 'media', 
    'action'=>'create',
));?>">Add new media</a></p>
<table class="table table-bordered table-hover">
    <tr>
        <th>Media</th>
        <th>&nbsp;</th>
        <th>&nbsp;</th>
        <th>&nbsp;</th>
        <th>&nbsp;</th>
    </tr>
    <?php foreach($medias as $media) : ?>
	    <tr>
	        <td><img src="<?php echo $this->escapeHtml($media->getFile()->getSrc());?>"></td>
	        <td><?php echo $this->escapeHtml($media->getSlug());?></td>
	        <td>
                <a href="<?php echo $this->url('blog', array(
                    'controller' => 'media', 
                    'action' => 'link', 
                    'id' => $media->getId(),
                )); ?>">Link to Post</a>
	        </td>
	        <td>
                <a href="<?php echo $this->url('blog', array(
                    'controller' => 'media', 
                    'action' => 'edit', 
                    'id' => $media->getId(),
                )); ?>">Edit</a>
	        </td>
	        <td>
                <a href="<?php echo $this->url('blog', array(
                    'controller' => 'media', 
                    'action' => 'delete',
                    'id' => $media->getId()
                )); ?>" onclick="return confirm('Are you sure?')">Delete</a>
	        </td>
	    </tr>
        <?php if (!$media->getPosts()->isEmpty()) : ?>
        <tr>
            <td>
            <?php 
                $return = '';
                foreach ($media->getPosts() as $post) :
                $return = (('' === $return)? '' : $return . ', ' ) . $post->getTitle() . ':<a href="' . $this->url(
                    'blog', array(
                    'controller' => 'media', 
                    'action' => 'unlink', 
                    'id' => $media->getId(),
                    'fourthparam' => $post->getId(),
                )) . '">unlink</a>';
                endforeach;
                echo $return;
                ?>
            </td>
        </tr>
        <?php endif ?>
    <?php endforeach; ?>
</table>
